
var timing = [{
  "time": 0,
  "tag": "fire",
  "start": 0
}, {
  "time": 3.533333333333333,
  "tag": "cows",
  "start": 0
}, {
  "time": 5.233333333333333,
  "tag": "cooking",
  "start": 0
}, {
  "time": 7.333333333333333,
  "tag": "chef",
  "start": 0
}, {
  "time": 8.166666666666666,
  "tag": "burger",
  "start": 0
}, {
  "time": 8.533333333333333,
  "tag": "food",
  "start": 0
}, {
  "time": 8.933333333333334,
  "tag": "eat",
  "start": 0
}, {
  "time": 10.333333333333334,
  "tag": "appliance",
  "start": 0
}, {
  "time": 12.266666666666667,
  "tag": "franchise",
  "start": 0
}, {
  "time": 13.666666666666666,
  "tag": "gold",
  "start": 0
}, {
  "time": 15.633333333333333,
  "tag": "money",
  "start": 0
}, {
  "time": 16.333333333333332,
  "tag": "burger",
  "start": 0
}, {
  "time": 17.166666666666668,
  "tag": "food",
  "start": 0
}, {
  "time": 18.466666666666665,
  "tag": "cooking",
  "start": 0
}, {
  "time": 20.6,
  "tag": "fire",
  "start": 0
}, {
  "time": 22.3,
  "tag": "money",
  "start": 0
}, {
  "time": 23.633333333333333,
  "tag": "cooking",
  "start": 0
}, {
  "time": 24,
  "tag": "burger",
  "start": 0
}, {
  "time": 25.333333333333332,
  "tag": "money",
  "start": 0
}, {
  "time": 26.2,
  "tag": "cows",
  "start": 0
}, {
  "time": 27.866666666666667,
  "tag": "cows",
  "start": 0
}, {
  "time": 30.433333333333334,
  "tag": "burger",
  "start": 0
}, {
  "time": 31.8,
  "tag": "burger",
  "start": 0
}, {
  "time": 34.3,
  "tag": "eat",
  "start": 0
}, {
  "time": 37.666666666666664,
  "tag": "money",
  "start": 0
}, {
  "time": 39.4,
  "tag": "cooking",
  "start": 0
}, {
  "time": 41.1,
  "tag": "cooking",
  "start": 0
}, {
  "time": 42.8,
  "tag": "burger",
  "start": 0
}, {
  "time": 43.666666666666664,
  "tag": "food",
  "start": 0
}, {
  "time": 44.13333333333333,
  "tag": "money",
  "start": 0
}, {
  "time": 44.56666666666667,
  "tag": "food",
  "start": 0
}, {
  "time": 45.833333333333336,
  "tag": "burger",
  "start": 0
}, {
  "time": 46.666666666666664,
  "tag": "cooking",
  "start": 0
}, {
  "time": 47.53333333333333,
  "tag": "fire",
  "start": 0
}, {
  "time": 48.46666666666667,
  "tag": "cooking",
  "start": 0
}, {
  "time": 48.86666666666667,
  "tag": "cows",
  "start": 0
}, {
  "time": 49.333333333333336,
  "tag": "money",
  "start": 0
}, {
  "time": 50.13333333333333,
  "tag": "cows",
  "start": 0
}, {
  "time": 51.03333333333333,
  "tag": "fire",
  "start": 0
}, {
  "time": 51.733333333333334,
  "tag": "cows",
  "start": 0
}, {
  "time": 53.63333333333333,
  "tag": "cooking",
  "start": 0
}, {
  "time": 54.46666666666667,
  "tag": "chef",
  "start": 0
}, {
  "time": 55.333333333333336,
  "tag": "money",
  "start": 0
}, {
  "time": 57.03333333333333,
  "tag": "eat",
  "start": 0
}, {
  "time": 58.3,
  "tag": "cooking",
  "start": 0
}, {
  "time": 59.166666666666664,
  "tag": "burger",
  "start": 0
}, {
  "time": 61.766666666666666,
  "tag": "food",
  "start": 0
}, {
  "time": 64.33333333333333,
  "tag": "gold",
  "start": 0
}, {
  "time": 66.1,
  "tag": "money",
  "start": 0
}, {
  "time": 66.53333333333333,
  "tag": "fire",
  "start": 0
}, {
  "time": 67.36666666666666,
  "tag": "cows",
  "start": 0
}, {
  "time": 68.1,
  "tag": "cooking",
  "start": 0
}, {
  "time": 68.96666666666667,
  "tag": "chef",
  "start": 0
}, {
  "time": 70.2,
  "tag": "burger",
  "start": 0
}, {
  "time": 70.86666666666666,
  "tag": "food",
  "start": 0
}, {
  "time": 72.13333333333334,
  "tag": "cooking",
  "start": 0
}, {
  "time": 73.86666666666666,
  "tag": "money",
  "start": 0
}, {
  "time": 75.53333333333333,
  "tag": "eat",
  "start": 0
}, {
  "time": 76.36666666666666,
  "tag": "cooking",
  "start": 0
}, {
  "time": 76.76666666666667,
  "tag": "burger",
  "start": 0
}, {
  "time": 78.16666666666667,
  "tag": "food",
  "start": 0
}, {
  "time": 78.53333333333333,
  "tag": "cows",
  "start": 0
}, {
  "time": 80.66666666666667,
  "tag": "cooking",
  "start": 0
}, {
  "time": 81.5,
  "tag": "chef",
  "start": 0
}, {
  "time": 82.23333333333333,
  "tag": "burger",
  "start": 0
}, {
  "time": 83.2,
  "tag": "food",
  "start": 0
}, {
  "time": 84.13333333333334,
  "tag": "eat",
  "start": 0
}, {
  "time": 85.76666666666667,
  "tag": "appliance",
  "start": 0
}, {
  "time": 87.5,
  "tag": "burger",
  "start": 0
}, {
  "time": 88.33333333333333,
  "tag": "gold",
  "start": 0
}, {
  "time": 90,
  "tag": "money",
  "start": 0
}, {
  "time": 90.9,
  "tag": "fire",
  "start": 0
}, {
  "time": 91.7,
  "tag": "cows",
  "start": 0
}, {
  "time": 93.53333333333333,
  "tag": "cooking",
  "start": 0
}, {
  "time": 96.06666666666666,
  "tag": "chef",
  "start": 0
}, {
  "time": 99.5,
  "tag": "burger",
  "start": 0
}, {
  "time": 102.86666666666666,
  "tag": "food",
  "start": 0
}, {
  "time": 105.46666666666667,
  "tag": "eat",
  "start": 0
}, {
  "time": 105.9,
  "tag": "fire",
  "start": 0
}, {
  "time": 107.13333333333334,
  "tag": "franchise",
  "start": 0
}, {
  "time": 108.73333333333333,
  "tag": "gold",
  "start": 0
}, {
  "time": 111.4,
  "tag": "money",
  "start": 0
}, {
  "time": 113.2,
  "tag": "fire",
  "start": 0
}, {
  "time": 116.56666666666666,
  "tag": "cows",
  "start": 0
}, {
  "time": 120.06666666666666,
  "tag": "cooking",
  "start": 0
}, {
  "time": 121.8,
  "tag": "chef",
  "start": 0
}, {
  "time": 122.66666666666667,
  "tag": "burger",
  "start": 0
}, {
  "time": 123.53333333333333,
  "tag": "food",
  "start": 0
}, {
  "time": 125.23333333333333,
  "tag": "eat",
  "start": 0
}, {
  "time": 126.96666666666667,
  "tag": "burger",
  "start": 0
}];

var renderer = new frampton.Renderer({
  mediaConfig: mediaConfig
});

var tagger = new frampton.Tagger(mediaConfig);
var expectedTags = ['fire', 'cows', 'cooking', 'chef', 'burger', 'food', 'eat', 'appliance', 'franchise', 'gold', 'money'];
expectedTags.forEach(function(tag) { tagger.tagVideosWithPattern(tag, tag); });

var startDelay = 1000;

var taggedVideos = {};
expectedTags.forEach(function(tag) { taggedVideos[tag] = tagger.videosWithTag(tag, {shuffle: true}); });

timing.forEach(function(timingItem, idx) {
  var tag = timingItem.tag;

  var videos = taggedVideos[tag];
  var video = videos.shift();
  if (videos.length === 0) {
    taggedVideos[tag] = tagger.videosWithTag(tag, {shuffle: true});
  }

  var videoSegment = new frampton.VideoSegment(video);
  videoSegment.setVolume(0);

  if (idx + 1 < timing.length) {
    var nextItem = timing[idx + 1];
    videoSegment.setDuration(nextItem.time - timingItem.time);
  }
  else {
    videoSegment.setDuration(3.5);
  }

  renderer.scheduleSegmentRender(videoSegment, startDelay + timingItem.time * 1000);
});

// check for MP3
var audio = document.createElement('audio');
if (!(audio.canPlayType && (audio.canPlayType('audio/mp3') || audio.canPlayType('audio/mpeg')))) {
  alert('Please use a browser that can play MP3s (Chrome, Safari, Internet Explorer 9+)');
}

// create aligner
var aligner = new window.AudioAligner(document.getElementById('target'), audio);
aligner.align('media/feed_the_streets.mp3', 'js/feed-the-streets-visual.json');

// play when visuals start
setTimeout(function() {
  audio.play();
}, startDelay);

setTimeout(function() {
  document.querySelector('.thanks').style.display = 'block';
}, 128000);
